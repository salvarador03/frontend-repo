import{m as D,r as i,a as F,a1 as m,j as e,B as L,L as E,a2 as U,a3 as q,h as M,x as T,p as V,N as P}from"./index-DAMA4hZh.js";const W=()=>{const{user:a,logout:w}=D(),[x,h]=i.useState([]),[v,O]=i.useState([]),[H,b]=i.useState(null),[u,I]=i.useState({"text.micuenta.titulo":"Mi cuenta","text.micuenta.logout":"Cerrar sesión","text.micuenta.detalles.cuenta":"DETALLES DE LA CUENTA","text.micuenta.informacion.personal":"INFORMACIÓN PERSONAL"}),[y,$]=i.useState(null),[g,r]=i.useState({isOpen:!1,message:"",type:""}),c="http://localhost:8080/api",f=F(),n=localStorage.getItem("authToken");i.useEffect(()=>{if(!n){r({isOpen:!0,message:"Authorization token is missing. Please log in.",type:"error"}),f("/login");return}m.get(`${c}/usuarios/listar`,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{const t=s.data.map(l=>({...l,roles:Array.isArray(l.roles)?l.roles.map(o=>o.authority):[]}));h(t)}).catch(s=>{console.error("Error fetching users:",s),r({isOpen:!0,message:"Error fetching users: "+s.message,type:"error"})})},[c,n,f]),i.useEffect(()=>{n&&m.get(`${c}/roles/listar`,{headers:{Authorization:`Bearer ${n}`}}).then(s=>O(s.data)).catch(s=>{r({isOpen:!0,message:"Error fetching roles: "+s.message,type:"error"})})},[c,n]);const A=s=>{b(s),r({isOpen:!0,message:`Ver detalles de: ${s.nombre}`,type:"success"})},k=s=>{b(s),r({isOpen:!0,message:`Editar detalles de: ${s.nombre}`,type:"success"})},R=s=>{m.delete(`${c}/usuarios/eliminar/${s}`,{headers:{Authorization:`Bearer ${n}`}}).then(t=>{h(x.filter(l=>l.id!==s)),r({isOpen:!0,message:"Usuario eliminado correctamente",type:"success"})}).catch(t=>{console.error("Error deleting user:",t),r({isOpen:!0,message:"Error deleting user: "+t.message,type:"error"})})},j=(s,t)=>{m.put(`${c}/usuarios/estado/${s}`,{estado:t},{headers:{Authorization:`Bearer ${n}`}}).then(l=>{h(x.map(o=>o.id===s?{...o,enabled:t==="enabled",bloqueado:t==="bloqueado"}:o)),r({isOpen:!0,message:"Estado actualizado",type:"success"})}).catch(l=>{console.error("Error updating estado:",l),r({isOpen:!0,message:"Error updating estado: "+l.message,type:"error"})})},C=s=>{$(y===s?null:s)},z=(s,t)=>{const l=s.roles||[],N=l.includes(t.authority)?l.filter(d=>d!==t.authority):[...l,t.authority];m.put(`${c}/usuarios/roles/${s.id}`,N,{headers:{Authorization:`Bearer ${n}`}}).then(d=>{h(x.map(p=>p.id===s.id?{...p,roles:N}:p)),r({isOpen:!0,message:"Roles actualizados",type:"success"})}).catch(d=>{console.error("Error updating roles:",d),r({isOpen:!0,message:"Error updating roles: "+d.message,type:"error"})})},B=()=>{r({isOpen:!1,message:"",type:""})};return e.jsx("div",{className:"flex flex-col items-center min-h-screen bg-zinc-100 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto w-full mt-40",children:[e.jsx(L,{}),e.jsxs("div",{className:"flex flex-col items-center mb-10",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:u["text.micuenta.titulo"]}),e.jsx(E,{to:"/logout",children:e.jsx("button",{className:"text-gray-700 hover:text-gray-900",onClick:w,children:u["text.micuenta.logout"]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between w-full",children:[e.jsx("div",{className:"w-full md:w-2/3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:s.nombre}),e.jsx("button",{onClick:()=>C(s.id),className:"text-gray-600 hover:text-gray-900",children:e.jsx(U,{})})]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"ID:"})," ",s.id]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Roles:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:v.map(t=>{const o=(s.roles||[]).includes(t.authority);return e.jsxs("div",{className:`flex items-center px-3 py-1 border rounded-full cursor-pointer ${o?"bg-gray-200":"bg-white"} hover:bg-gray-100`,onClick:()=>z(s,t),children:[t.authority,o&&e.jsx(q,{className:"ml-2 text-green-500"})]},t.id)})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("strong",{children:"Estado:"}),e.jsxs("div",{className:"flex mt-2",children:[e.jsx("button",{onClick:()=>j(s.id,"enabled"),className:`px-2 py-1 rounded-l ${s.enabled?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"}`,children:"Habilitado"}),e.jsx("button",{onClick:()=>j(s.id,"bloqueado"),className:`px-2 py-1 rounded-r ${s.bloqueado?"bg-red-500 text-white":"bg-gray-200 text-gray-700"}`,children:"Bloqueado"})]})]}),y===s.id&&e.jsx("div",{className:"absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>A(s),className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full",children:[e.jsx(M,{className:"mr-2"})," Ver"]}),e.jsxs("button",{onClick:()=>k(s),className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full",children:[e.jsx(T,{className:"mr-2"})," Editar"]}),e.jsxs("button",{onClick:()=>R(s.id),className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full",children:[e.jsx(V,{className:"mr-2"})," Borrar"]})]})})]},s.id))}),e.jsxs("div",{className:"w-full md:w-1/3 mt-8 md:mt-0 md:ml-10",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:u["text.micuenta.detalles.cuenta"]}),e.jsx("p",{className:"mb-4",children:(a==null?void 0:a.name)+" "+(a==null?void 0:a.lastName)}),e.jsx("p",{className:"mb-4",children:a==null?void 0:a.city}),e.jsx("p",{className:"mb-4",children:a==null?void 0:a.country}),e.jsx("p",{className:"mb-4",children:a==null?void 0:a.phone}),e.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:e.jsx(E,{to:"/admin/account-management/information",children:u["text.micuenta.informacion.personal"]})})]})]}),e.jsx(P,{type:g.type,message:g.message,isOpen:g.isOpen,onClose:B})]})})};export{W as default};
