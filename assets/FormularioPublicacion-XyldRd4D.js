import{m as H,a as J,r as a,C as z,j as e,N as B,n as b,J as U,o as K,p as Q,q as V,A as W,s as X}from"./index-pt3s4JTT.js";const Z=({onPostAdded:h})=>{const{user:m}=H(),O=J(),[E,p]=a.useState(null),[o,l]=a.useState({titulo:"",contenido:"",categoriaId:"",secciones:[]}),[c,n]=a.useState({isOpen:!1,message:"",type:""}),[F,d]=a.useState(!1),[u,f]=a.useState({nombre:"",descripcion:""}),[I,k]=a.useState([]);a.useRef(null);const A=a.useRef(null),[i,x]=a.useState({titulo:"",contenido:""}),[D,y]=a.useState(!0),[T,P]=a.useState([]);a.useEffect(()=>{j()},[]);const j=async()=>{try{const t=await z();k(t)}catch(t){console.error("Error fetching categories:",t)}},R=t=>p(t.target.files[0]),N=t=>{const{name:s,value:r}=t.target;l({...o,[s]:s==="categoriaId"?Number(r):r})},q=t=>{x({...i,contenido:t})},L=()=>{if(i.titulo.trim()&&i.contenido.trim()){const t={...i,id:`section-${o.secciones.length+1}`};l({...o,secciones:[...o.secciones,t]}),P([...T,t]),x({titulo:"",contenido:""}),y(!1)}else n({isOpen:!0,message:"El título y contenido de la sección no pueden estar vacíos",type:"error"})},v=t=>{const s=document.createElement("div");return s.innerHTML=t,s.textContent||s.innerText||""},M=async t=>{t.preventDefault();const{titulo:s,categoriaId:r,secciones:w}=o;if(!m||!m.username)return n({isOpen:!0,message:"User is not logged in",type:"error"});if(!r)return n({isOpen:!0,message:"Selecciona una categoria",type:"error"});if(!s.trim())return n({isOpen:!0,message:"El titulo no puede estar vacío",type:"error"});if(w.length===0)return n({isOpen:!0,message:"Debe añadir al menos una sección",type:"error"});try{const g=w.map(S=>`<h2>${S.titulo}</h2>
${S.contenido}`).join(`

`),G=v(g);await W({...o,contenido:G},E,r,m.username),l({titulo:"",contenido:"",categoriaId:"",secciones:[]}),p(null),document.getElementById("image").value=null,typeof h=="function"&&h(),n({isOpen:!0,message:"Publicación añadida exitósamente",type:"success"}),O("/admin/publicaciones")}catch(g){console.error(g),n({isOpen:!0,message:"Algo fue mal",type:"error"})}},C=t=>{const{name:s,value:r}=t.target;f({...u,[s]:r})},$=async t=>{t.preventDefault();try{await X(u),d(!1),n({isOpen:!0,message:"Categoría creada exitósamente",type:"success"}),f({nombre:"",descripcion:""}),j()}catch(s){console.error("Error creando la categoría:",s),n({isOpen:!0,message:"Error creando la categoría",type:"error"})}};return e.jsxs("div",{className:"container mx-auto my-8",children:[c.isOpen&&e.jsx(B,{type:c.type,message:c.message,isOpen:c.isOpen,onClose:()=>n({...c,isOpen:!1})}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-full lg:w-2/3",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6",children:[e.jsx("h3",{className:"text-2xl font-semibold text-center mb-6",children:"Añadir nueva publicación"}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"categoriaId",className:"block text-gray-700 text-sm font-bold mb-2",children:"Seleccionar Categoria"}),e.jsxs("select",{id:"categoriaId",name:"categoriaId",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",onChange:N,value:o.categoriaId,children:[e.jsx("option",{value:"",children:"--Seleccionar categoria--"}),I.map(t=>e.jsx("option",{value:t.cid,children:t.nombre},t.cid))]})]}),e.jsx("button",{type:"button",className:"ml-2 p-2",onClick:()=>d(!0),children:e.jsx(b,{size:20,className:"text-black mt-6"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"image",className:"block text-gray-700 text-sm font-bold mb-2",children:"Seleccionar banner de la publicación"}),e.jsx("input",{id:"image",name:"image",type:"file",className:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none",onChange:R}),e.jsx("small",{className:"text-gray-600",children:"La imagen seleccionada se convertirá en la imagen principal de tu publicación"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"titulo",className:"block text-gray-700 text-sm font-bold mb-2",children:"Título de la publicacion"}),e.jsx("input",{id:"titulo",name:"titulo",placeholder:"Introducir Título de Publicacion",type:"text",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:o.titulo,onChange:N})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Añadir Nueva Sección"}),D?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Título de la Sección",className:"w-full p-2 mb-2 border rounded",value:i.titulo,onChange:t=>x({...i,titulo:t.target.value})}),e.jsx(U,{ref:A,value:i.contenido,onChange:q}),e.jsxs("button",{type:"button",className:"bg-blue-500 text-white px-4 py-2 rounded mt-4 flex items-center",onClick:L,children:[e.jsx(b,{className:"mr-2"})," Agregar Sección"]})]}):e.jsxs("button",{type:"button",className:"bg-blue-500 text-white px-4 py-2 rounded mt-4 flex items-center",onClick:()=>y(!0),children:[e.jsx(b,{className:"mr-2"})," Añadir una nueva sección"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Resultado:"}),o.secciones.map((t,s)=>e.jsxs("div",{className:"mb-2 p-4 border rounded bg-gray-100",children:[e.jsx("h4",{className:"font-bold text-lg mb-2",children:t.titulo}),e.jsxs("p",{children:[v(t.contenido).substring(0,100),"..."]})]},s))]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("button",{type:"submit",className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center",children:[e.jsx(K,{className:"mr-2"})," Guardar"]}),e.jsxs("button",{type:"reset",onClick:()=>l({titulo:"",contenido:"",categoriaId:"",secciones:[]}),className:"ml-4 bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center",children:[e.jsx(Q,{className:"mr-2"})," Limpiar"]})]})]})]})})}),e.jsxs(V,{isOpen:F,onClose:()=>d(!1),children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Crear Nueva Categoria"}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"nombre",className:"block text-gray-700 text-sm font-bold mb-2",children:"Nombre"}),e.jsx("input",{id:"nombre",name:"nombre",type:"text",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:u.nombre,onChange:C})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"descripcion",className:"block text-gray-700 text-sm font-bold mb-2",children:"Descripción"}),e.jsx("textarea",{id:"descripcion",name:"descripcion",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:u.descripcion,onChange:C})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Guardar"}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:"ml-4 bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Cancelar"})]})]})]})]})};export{Z as default};
